# ğŸ˜‚ 3.2ç‰©ç†ç³»ç»Ÿè„šæœ¬ç¼–ç¨‹

## 3.2.1è·å–åˆšä½“ç»„ä»¶

å½“ä¸€ä¸ªç‰©ä½“æŒ‚è½½äº†åˆšä½“æ—¶ï¼Œå³å¯åœ¨è„šæœ¬ä¸­è·å–è¯¥ç‰©ä½“çš„åˆšä½“ç»„ä»¶

```csharp
using UnityEngine;
public class Test:MonoBehaviour{
    Rigidbody rigid;
    void Start()
    {
        rigid=GetComponent<Rigidbody>();
        }
    }
```

ä¸€èˆ¬å°†åˆšä½“å˜é‡å‘½åä¸ºrigidå¹¶å®šä¹‰ä¸ºä¸€ä¸ªå­—æ®µï¼Œæ–¹ä¾¿åå¤ä½¿ç”¨

## 3.2.2æ–½åŠ ä½œç”¨åŠ›

### AddForceï¼ˆï¼‰

å‚æ•°ä¸ºVector3ç±»å‹ï¼Œç”¨ä¸€ä¸ªå‘é‡è¡¨ç¤ºåŠ›ã€‚

```csharp
private void Update(){
    if(Input.GetButtonDown("Jump")){
        rigid.AddForce(new Vector3(0,100,0));
        }
    }
```

æŒç»­æ—¶é—´æ˜¯ä¸€ä¸ªç‰©ç†å¸§é—´éš” é»˜è®¤0.02ç§’

## 3.2.3ä¿®æ”¹é€Ÿåº¦

### è®©ç‰©ä½“åŒ€é€Ÿè¿åŠ¨

æ¯å¸§è®©ç‰©ä½“çš„ä½ç½®å‰è¿›ä¸€æ®µå¾ˆçŸ­çš„è·ç¦»

```csharp
//è·å–å½“å‰ç‰©ä½“é€Ÿåº¦
Vector3 vel=rigid.velocity;
//å°†å½“å‰é€Ÿåº¦æ²¿zè½´å¢åŠ åˆ°1m/s
rigid.velocity-=vel+new Vector3(0,0,1);
```

### æŒ‰ç©ºæ ¼é”®æ—¶è·³è·ƒï¼Œå¹¶åœ¨ç©ºä¸­å¤šæ¬¡è·³è·ƒ

```csharp
using UnityEngine;
public class SimpleJump:MonoBehaviour
{
    Rigidbody rigid;
    void Start(){
        rigid=GetComponent<Rigidbody>();
        }
    private void Update(){
        if(Input.GetButtonDown("Jump")){
            rigid.AddForce(new Vector3(0,100,0);
            }
        }
    }
```

#### ä¼˜åŒ–

```csharp
using UnityEngine;
public class SimpleJump:MonoBehaviour
{
    Rigidbody rigid;
    void Start(){
        rigid=GetComponent<Rigidbody>();
        }
    private void Update(){
        if(Input.GetButtonDown("Jump")){
            rigid.velocity=new Vector3(rigid.velocity.x,0,rigid.velocity.z);
            rigid.AddForce(new Vector3(0,100,0);
            }
        }
    }
```

## 3.2.4å°„çº¿çš„ä½¿ç”¨æ–¹æ³•

* æ¸¸æˆä¸­æœ‰å•å‡»åœ°é¢çš„æ“ä½œï¼Œå› æ­¤è¦å‘å°„å°„çº¿ä»¥ç¡®å®šæ˜¯å¦ç‚¹å‡»ä¸­äº†å¯å•å‡»åŒºåŸŸå’Œå•å‡»ä½ç½®çš„åæ ‡ã€‚
* åœ¨åˆ¤å®šå­å¼¹æˆ–æŠ€èƒ½æ˜¯å¦å‡»ä¸­ç›®æ ‡æ—¶ï¼Œå°„çº¿æ²¡æœ‰é€Ÿåº¦ï¼ˆç¬æ—¶å‘ç”Ÿï¼‰ï¼Œæ˜“äºä½¿ç”¨ï¼Œç»¼åˆæ•ˆç‡é«˜
* 3Dæˆ–2DåŠ¨ä½œæ¸¸æˆä¸­ï¼Œåˆ¤æ–­ç©å®¶æ˜¯å¦è½åœ°æ—¶ï¼Œå¯ä»¥å‘è§’è‰²è„šä¸‹å‘å°„å°„çº¿ï¼›åˆ¤æ–­ç©å®¶æ˜¯å¦æ¥è¿‘å¢™å£ï¼Œå¯ä»¥å¾€å·¦å³ä¸¤ä¾§å‘å°„å°„çº¿ï¼›åˆ¤æ–­ç©å®¶æ˜¯å¦ä½å¤´æ—¶ï¼Œå¯ä»¥å¾€å¤´é¡¶å‘å°„çº¿ï¼›åˆ¤æ–­ç©å®¶æ˜¯å¦éœ€è¦æ”€çˆ¬ä¹Ÿå¯å‘å°„å°„çº¿ã€‚
* å°„çº¿ä¸è§†çº¿ä¸€æ ·ä¼šè¢«éšœç¢ç‰©é˜»æŒ¡ï¼Œæ‰€ä»¥åœ¨æ¸¸æˆAIè®¾è®¡ä¸­ï¼Œå¯ä»¥ç”¨å°„çº¿æ¨¡æ‹ŸAIè§’è‰²çš„è§†çº¿ã€‚

å°„çº¿éœ€è¦ä¸ç¢°æ’ä½“å’Œè§¦å‘å™¨é…åˆæ‰èƒ½å‘æŒ¥å‡ºä½œç”¨ã€‚

### å°„çº¿ç¼–ç¨‹æ–¹æ³•

å¸¸ç”¨çš„ç›´çº¿å‹å°„çº¿ç”¨ç±»å‹Rayè¡¨ç¤ºã€‚RayåŒ…å«äº†origin(èµ·ç‚¹ï¼‰å’Œdirectionï¼ˆæ–¹å‘ï¼‰çš„å®šä¹‰ã€‚èµ·ç‚¹å’Œæ–¹å‘éƒ½ç”¨Vector3ç±»å‹è¡¨ç¤ºï¼Œå‰è€…æ˜¯ä¸€ä¸ªåæ ‡ï¼Œåè€…æ˜¯ä¸€ä¸ªè¡¨ç¤ºæ–¹å‘çš„å‘é‡ã€‚

### å‘å°„å°„çº¿æ–¹æ³•Physics.Raycast()\Physics.RaycastAll()

```csharp
bool Raycast(Vector3 origin,Vector3 direction);
bool Raycast(Vector3 origin,Vector3 direction,float maxDistance);
bool Raycast(Vector3 origin,Vector3 direction,float maxDistance,int layerMask);
```

å‘å°„ç‚¹åæ ‡ã€æ–¹å‘å‘é‡ï¼Œè¿”å›å€¼éƒ½æ˜¯æ˜¯å¦å‡»ä¸­äº†æŸä¸ªç¢°æ’ä½“æˆ–è§¦å‘å™¨ã€‚

```csharp
bool Raycast(Ray ray,out RaycastHit hitInfo);
bool Raycast(Ray ray,out RaycastHit hitInfo,float maxDistance);
bool Raycast(Ray ray,out RaycastHit hitInfo,float maxDistanceï¼Œint layerMask);
```

```csharp
//åˆ›å»ºä»åŸç‚¹å‘ä¸Šçš„å°„çº¿
Ray ray=new Ray(Vector3.zero,Vector3.up);
//è·å¾—å½“å‰é¼ æ ‡æŒ‡é’ˆåœ¨å±å¹•ä¸Šçš„ä½ç½®ï¼ˆå•ä½æ˜¯åƒç´ )
Vector2 mousePos=Input.mousePosition;
//åˆ›å»ºä¸€æ¡å°„çº¿ï¼Œèµ·ç‚¹æ˜¯æ‘„åƒæœºä½ç½®ï¼Œæ–¹å‘æŒ‡å‘é¼ æ ‡æŒ‡é’ˆæ‰€åœ¨çš„ç‚¹ï¼ˆéšå«äº†å±å¹•åˆ°ä¸–ç•Œçš„åæ ‡è½¬æ¢ï¼‰
Ray ray2=Camera.main.ScreenPointToRay(mousePos);
//ä¹‹åå¯ä»¥å°†rayæˆ–ray2å‘å°„å‡ºå»
physics.Raycast(ray,10000,LayerMask.GetMask("Default");
```

åœ¨hitInfoä¸­ä¿å­˜ç€è¯¦ç»†çš„ç¢°æ’ä¿¡æ¯ï¼Œå¦‚ç¢°æ’ç‚¹çš„é…ç½®ã€æ³•å‘ç­‰ã€‚

## 3.2.5å±‚å’Œé®ç½©å±‚

å¾ˆå¤šæ—¶å€™éœ€è¦å°„çº¿ä»…è¢«æŸäº›ç‰©ä½“é˜»æŒ¡ï¼Œä¾‹å¦‚å¸Œæœ›æ£€æµ‹åœ°é¢çš„å°„çº¿åªæ£€æµ‹åœ°é¢ï¼Œè€Œä¸è¦æ£€æµ‹å…¶ä»–ä¸œè¥¿ã€‚

### ä¸€æ¡å­å¼¹å°„çº¿è®©ä»–åªç¢°åˆ°Groundã€Playerã€Obstacle

```csharp
int mask=LayerMask.GetMask("Ground","Player","Obstacle");
if(physics.Raycast(transform.position,Vector3.forward,mask))
    {
        //ç¢°åˆ°äº†ç‰©ä½“
        
        }
```

ç”¨ä¸€ä¸ªintæœ€å¤šå¯ä»¥è¡¨ç¤º32ä¸ªå±‚é®ç½©ã€‚

### è®©maskè¡¨ç¤ºè¿™ä¸‰å±‚ä»¥å¤–çš„æ‰€æœ‰å±‚

```csharp
mask=~mask;//è‹±æ–‡æ³¢æµªçº¿ï¼Œä»£è¡¨äºŒè¿›åˆ¶å–å
```

### æ”¹å˜ç‰©ä½“æ‰€åœ¨çš„å±‚

```csharp
gameObject.layer=layerMask.NameToLayer("Default");
```

## 3.2.6å°„çº¿ç¼–ç¨‹è¯¦è§£

### 1.å°„çº¿ç¢°æ’ä¿¡æ¯

```csharp
private void TestRay(){
    //å£°æ˜å˜é‡ï¼Œç”¨äºä¿å­˜ç¢°æ’ä¿¡æ¯
    RaycastHit hitInfo;
    //å‘å°„å°„çº¿ï¼Œèµ·ç‚¹æ˜¯å½“å‰ç‰©ä½“çš„ä½ç½®ï¼Œæ–¹å‘æ˜¯ä¸–ç•Œå‰æ–¹
    if(Physics.Raycast(transform.position,Vecctor3.forward,out hitInfo)){
        //å¦‚æœç¡®å®ç¢°æ’åˆ°ç‰©ä½“ï¼Œè¿è¡Œåˆ°è¿™é‡Œï¼Œæ²¡ç¢°åˆ°ä¸è¿è¡Œ
        //è·å–ç¢°æ’ç‚¹çš„åæ ‡ï¼ˆä¸–ç•Œåæ ‡ï¼‰
        Vector3 point=hitInfo.point;
        //è·å–å¯¹æ–¹çš„ç¢°æ’ä½“ç»„ä»¶
        Collider coll=hitInfo.collider;
        //è·å–å¯¹æ–¹çš„Transformç»„ä»¶
        Transform trans=hitInfo.transform;
        //è·å–å¯¹æ–¹çš„ç‰©ä½“åç§°
        string name=coll.gameObject.name;
        //è·å–ç¢°æ’ç‚¹çš„æ³•çº¿å‘é‡
        Vector3 normal=hitInfo.normal;
```

### 2.å…¶ä»–å½¢çŠ¶çš„å°„çº¿

<pre class="language-csharp"><code class="lang-csharp"><strong>//çƒå½¢å°„çº¿
</strong><strong>bool SphereCast(Ray ray,float radius);
</strong>bool SphereCast(Ray ray,float radius,out RayccastHit hitInfo);
//ç›’å­å°„çº¿
bool BoxCast(Vector3 center,Vector3 halfExtents,Vector3 Direction);
bool BoxCast(Vector3 center,Vector3 halfExtents,Vector3 Direction,out RayccastHit hitInfo,Quaternion orientation);
//èƒ¶å›Šä½“å°„çº¿
bool CapsuleCast(Vector3 point1,Vector3 point2,float radius,Vector3 direction);
bool CapsuleCast(Vector3 point1,Vector3 point2,float radius,Vector3 direction,out RayccastHit hitInfo,float maxDistance);
</code></pre>

### 3. ç©¿è¿‡å¤šä¸ªç‰©ä½“çš„å°„çº¿

æœ‰æ—¶éœ€è¦å°„çº¿åœ¨é‡åˆ°ç¬¬ä¸€ä¸ªç‰©ä½“æ—¶ä¸åœæ­¢ï¼Œç»§ç»­å‰è¿›ï¼Œæœ€ç»ˆç©¿è¿‡å¤šä¸ªç‰©ä½“ã€‚ä½¿ç”¨Physics.RaycastAll()å‡½æ•°å¯ä»¥è·å–åˆ°å°„çº¿æ²¿é€”ç¢°åˆ°çš„æ‰€æœ‰ç¢°æ’ä¿¡æ¯ï¼Œè¯¥å‡½æ•°çš„åèƒ¡å­hiæ˜¯RaycastHitæ•°ç»„ã€‚

```csharp
RaycastHit[] RaycastAll(Ray ray,float maxDistance);
RaycastHit[] RaycastAll(Vector3 origin,Vector3 direction,float maxDistance);
RaycastHit[] RaycastAll(Ray ray,float max Distance,int layerMask);
RaycastHit[] RaycastAll(Ray ray);
```

### 4.åŒºåŸŸè¦†ç›–å‹å°„çº¿ï¼ˆOverlapï¼‰

æ£€æµ‹ä¸€ä¸ªç©ºé—´èŒƒå›´ï¼Œå¦‚çˆ†ç‚¸æ³¢åŠèŒƒå›´

```csharp
Collider[] OverlapBox(Vector3 center,Vector3 halfExtents,Quaternion orientation,int layerMask);
Collider[] OverlapCapsule(Vector3 point0,Vector3 point1,float radius,int layerMask);
Collider[] OverlapSphere(Vector3 position,float radius,int layerMask);
```

### 5.å°„çº¿è°ƒè¯•æŠ€å·§

#### Debug.DrawLine()\Debug.DrawRay()

å¯è§†åŒ–å°„çº¿

```csharp
void DrawLine(Vector3 start,Vector3 end,Color color);
void DrawLine(Vector3 start,Vector3 end,Color color, float duration);
void DrawRay(Vector3 start,Vector3 dir,Color color);
void DrawRay(Vector3 start,Vector3 dir,Color color,float duration);
```

åº”æ­£ç¡®ä½¿ç”¨å‘é‡åŠ æ³•

```
//ä»¥ä¸€ä¸ªç®€å•çš„å°„çº¿ä¸ºä¾‹
Raycastï¼ˆèµ·ç‚¹ï¼Œæ–¹å‘å‘é‡ï¼Œé•¿åº¦ï¼‰ï¼›
//å¯¹åº”çš„çº¿æ¡å¯è§†åŒ–
DrawLine(èµ·ç‚¹ï¼Œèµ·ç‚¹+æ–¹å‘å‘é‡.normalized*é•¿åº¦ï¼ŒColor.red);
//å…¶ä¸­normalizedæ˜¯å°†å‘é‡æ ‡å‡†åŒ–ï¼Œå³æ–¹å‘ä¸å˜é•¿åº¦å˜1
```

## 3.2.7ä¿®æ”¹ç‰©ç†æè´¨

åœ¨projectçª—å£ä¸­å•å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©Create->Physics Material

### å‚æ•°

* Dynamic Frictionï¼ˆåŠ¨æ€æ‘©æ“¦ç³»æ•°ï¼‰
* Static Friction ï¼ˆé™æ€æ‘©æ“¦ç³»æ•°ï¼‰
* Bouncinessï¼ˆå¼¹æ€§ç³»æ•°ï¼‰
* ä¸å…¶ä»–ç‰©ä½“æ¥è§¦æ—¶çš„Friction Combineï¼ˆæ‘©æ“¦åŠ›ç³»æ•°ç®—æ³•ï¼‰å’ŒBounce Combine(å¼¹æ€§ç³»æ•°ç®—æ³•)

å¼¹æ€§ç³»æ•°ä¸€èˆ¬ä¸é«˜äº0.9

